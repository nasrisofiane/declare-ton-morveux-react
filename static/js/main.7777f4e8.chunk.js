(this["webpackJsonpdeclare-ton-morveux"]=this["webpackJsonpdeclare-ton-morveux"]||[]).push([[0],{129:function(e,t,n){},160:function(e,t,n){},161:function(e,t,n){},269:function(e,t,n){"use strict";n.r(t);n(120),n(121),n(122);var c=n(108),o=n.n(c),r=n(1),a=n.n(r),s=n(32),i=n.n(s),l=n(16),u=(n(129),n(8)),d=n(7),j=n(19),b=n(4),h=n(2),O=Object(r.createContext)(),f=function(e){var t=e.children,n=Object(r.useState)({all:new Map,selectedSchool:{}}),c=Object(u.a)(n,2),o=c[0],a=c[1],s=Object(r.useState)({id:null,username:null,isAuthenticated:!1,token:null}),i=Object(u.a)(s,2),l=i[0],d=i[1],j=Object(r.useState)([]),f=Object(u.a)(j,2),x=f[0],p=f[1],m=function(){fetch("".concat("https://declare-ton-morveux.herokuapp.com","/isAuthenticated"),{credentials:"include"}).then((function(e){return e.json()})).then((function(e){return d((function(t){return Object(b.a)(Object(b.a)({},t),{},{isAuthenticated:e})}))}))};return Object(r.useEffect)((function(){fetch("".concat("https://declare-ton-morveux.herokuapp.com","/api/schools")).then((function(e){return e.json()})).then((function(e){var t=new Map(e.map((function(e){return[e.name,e]})));a((function(e){return Object(b.a)(Object(b.a)({},e),{},{all:t})}))})),m()}),[]),Object(r.useEffect)((function(){l.isAuthenticated&&fetch("".concat("https://declare-ton-morveux.herokuapp.com","/api/parents/me"),{credentials:"include"}).then((function(e){return e.json()})).then((function(e){d((function(t){return Object(b.a)(Object(b.a)({},t),{},{id:e.id,username:e.username})}))}))}),[l.isAuthenticated]),Object(h.jsx)(O.Provider,{value:{schools:o,setSchools:a,user:l,setUser:d,fetchIsAuthenticated:m,fetchMyChildren:function(){Number.isInteger(l.id)&&fetch("".concat("https://declare-ton-morveux.herokuapp.com","/api/children/parent/").concat(l.id),{credentials:"include"}).then((function(e){return e.json()})).then((function(e){p(e)}))},myChildren:x},children:t})},x=function(){var e=Object(r.useContext)(O),t=Object(r.useState)(!1),n=Object(u.a)(t,2),c=n[0],o=n[1],a=function(){fetch("".concat("https://declare-ton-morveux.herokuapp.com","/logout"),{method:"POST",credentials:"include"}).then((function(e){return e.text()})).then((function(t){return e.fetchIsAuthenticated()})).catch((function(e){return console.log("error",e)}))};return Object(r.useEffect)((function(){o(e.user.isAuthenticated)}),[e.user.isAuthenticated]),Object(h.jsxs)(d.n,{color:"default-color",dark:!0,expand:"md",children:[Object(h.jsx)(d.o,{children:Object(h.jsx)(j.b,{className:"navbar-brand",to:"/",children:"D\xe9clare Ton Morveux"})}),Object(h.jsx)(d.q,{}),Object(h.jsxs)(d.f,{id:"navbarCollapse3",navbar:!0,children:[Object(h.jsx)(d.p,{left:!0}),Object(h.jsxs)(d.p,{right:!0,children:[Object(h.jsx)(d.m,{className:"mr-3",children:Object(h.jsx)(j.b,{className:"nav-link",to:"/childDeclaration",children:"D\xe9clarez un enfant"})}),function(){if(c)return Object(h.jsx)(d.m,{children:Object(h.jsx)(d.d,{onClick:a,className:"m-0",children:Object(h.jsx)(d.h,{style:{color:"white"},icon:"sign-out-alt"})})})}()]})]})]})},p=n(25),m=function(e){var t=e.children,n=Object(p.a)(e,["children"]),c=Object(r.useContext)(O).user,o=(Object(l.g)().state||{from:{pathname:"/"}}).from;return Object(h.jsx)(l.b,Object(b.a)(Object(b.a)({},n),{},{render:function(e){var n=e.location;return c.isAuthenticated?Object(h.jsx)(l.a,{to:{pathname:o.pathname,state:{from:n}}}):t}}))},v=function(e){var t=e.children,n=Object(p.a)(e,["children"]),c=Object(r.useContext)(O).user;Object(l.g)();return Object(h.jsx)(l.b,Object(b.a)(Object(b.a)({},n),{},{render:function(e){var n=e.location;return c.isAuthenticated?t:Object(h.jsx)(l.a,{to:{pathname:"/login",state:{from:n}}})}}))},g=n(14),y=(n(160),{container:{position:"relative",width:"10%",minWidth:"300px",maxWidth:"700px",zIndex:1e3},mdbContainer:{fontSize:"13px",padding:"0px",margin:"0px"},mdbListGroup:{width:"100%",position:"absolute",height:"auto",maxHeight:(window.innerWidth,window.innerHeight/2.9),overflowX:"hidden",overflowY:"auto"}}),C=function(e){var t,n=e.isLocal,c=e.getter,o=Object(r.useContext)(O),a=o.schools,s=o.setSchools,i=Object(r.useState)(""),l=Object(u.a)(i,2),j=l[0],f=l[1],x=Object(r.useState)("none"),p=Object(u.a)(x,2),m=p[0],v=p[1],C=Object(r.useState)([]),S=Object(u.a)(C,2),N=S[0],k=S[1],w=Object(r.useState)(!1),A=Object(u.a)(w,2),E=A[0],M=A[1],H=function(e){var t=e.target.attributes.value.value;f(t)},B=function(e){var t="block",n="none";!0===e&&m!=t?v(t):!1===e&&m!=n&&!1===E&&v(n)},D=function(){var e=Array.from(a.all).filter((function(e){var t=Object(u.a)(e,2);t[0];return function(e){return e!==j&&e.includes(j)}(t[1].name)}));k(e)};return Object(r.useEffect)((function(){!function(){var e=j;if(""!=e&&e&&"undefined"!=typeof e){var t=a.all.get(e);null!=t&&(!0===n?c(t):s((function(e){return Object(b.a)(Object(b.a)({},e),{},{selectedSchool:t})})))}}(),D()}),[j]),Object(r.useEffect)((function(){D()}),[a.all]),Object(h.jsxs)("div",{style:y.container,children:[Object(h.jsx)(d.j,(t={autoComplete:"off",id:"school-input",onBlur:function(){return B(!1)},onFocus:function(){return B(!0)},value:j},Object(g.a)(t,"id","school-input"),Object(g.a)(t,"label","Ecoles"),Object(g.a)(t,"icon","school"),Object(g.a)(t,"type","text"),Object(g.a)(t,"list","schools"),Object(g.a)(t,"onChange",(function(e){var t=e.target.value;f(t)})),t)),Object(h.jsx)("div",{id:"schools",style:{display:m},children:Object(h.jsx)(d.g,{style:y.mdbContainer,children:Object(h.jsx)(d.k,{onMouseEnter:function(){return M(!0)},onMouseLeave:function(){return M(!1)},style:y.mdbListGroup,children:N.map((function(e){var t=Object(u.a)(e,2),n=t[0],c=t[1];return Object(h.jsxs)(d.l,{id:n,value:c.name,onClick:H,hover:!0,children:[c.name," "]},n)}))})})})]})},S=(n(161),function(){var e=Object(r.useState)(null),t=Object(u.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(""),a=Object(u.a)(o,2),s=a[0],i=a[1],l=Object(r.useState)(""),j=Object(u.a)(l,2),b=j[0],f=j[1],x=Object(r.useContext)(O).fetchMyChildren,p=function(){i(""),f("")};return Object(h.jsx)(d.g,{children:Object(h.jsxs)(d.t,{className:"d-flex flex-column justify-content-center align-items-center mt-4",children:[Object(h.jsx)("p",{className:"h5 text-center mb-4",children:"Ajoutez un enfant"}),Object(h.jsx)(d.e,{md:"12",children:Object(h.jsxs)("form",{className:"d-flex flex-row justify-content-center",children:[Object(h.jsxs)("div",{className:"grey-text d-flex flex-row justify-content-center align-items-center",children:[Object(h.jsxs)("div",{className:"d-flex flex-row justify-content-center",children:[Object(h.jsx)("div",{className:"mr-1",children:Object(h.jsx)(d.j,{value:b,type:"text",onChange:function(e){var t=e.target.value;f(t)},label:"Nom",icon:"child"})}),Object(h.jsx)("div",{className:"ml-1 mr-4",children:Object(h.jsx)(d.j,{value:s,type:"text",onChange:function(e){var t=e.target.value;i(t)},label:"Pr\xe9nom"})})]}),Object(h.jsx)("div",{className:"ml-4 mr-4",children:Object(h.jsx)(C,{isLocal:!0,getter:function(e){c(e)}})})]}),Object(h.jsx)("div",{id:"add-child-btn",className:"text-center d-flex justify-content-center align-items-center",children:Object(h.jsx)(d.d,{onClick:function(){var e=new Headers,t={firstName:s,lastName:b,school:{id:n.id}};e.append("Content-Type","application/json"),null!=n&&fetch("".concat("https://declare-ton-morveux.herokuapp.com","/api/children"),{headers:e,method:"post",credentials:"include",body:JSON.stringify(t)}).then((function(e){if(e.ok)return x(),p(),e.json()}))},className:"ml-4",children:Object(h.jsx)(d.h,{icon:"plus"})})})]})})]})})}),N=(n(268),n(162),function(e){var t=e.id,n=e.isSick,c=e.isContagious,o=Object(r.useState)(!1),a=Object(u.a)(o,2),s=a[0],i=a[1],l=Object(r.useState)(!1),j=Object(u.a)(l,2),b=j[0],O=j[1],f=Object(r.useState)(null),x=Object(u.a)(f,2),p=x[0],m=x[1];Object(r.useEffect)((function(){i(n),O(c)}),[]);return Object(h.jsxs)("div",{className:"d-flex flex-row justify-content-between",children:[Object(h.jsxs)("div",{className:"custom-control custom-checkbox",children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("input",{onChange:function(e){var t=e.target.checked;i(t)},id:"sick-checkbox-"+t,checked:s,className:"custom-control-input",type:"checkbox"}),Object(h.jsx)("label",{className:"custom-control-label",htmlFor:"sick-checkbox-"+t,children:"Malade"})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("input",{onChange:function(e){var t=e.target.checked;O(t)},id:"contagious-checkbox-"+t,checked:b,className:"custom-control-input",type:"checkbox"}),Object(h.jsx)("label",{className:"custom-control-label",htmlFor:"contagious-checkbox-"+t,children:"Contagieux"})]})]}),Object(h.jsxs)("div",{children:[function(){var e,t;if(p?(e="success",t="check-circle"):(e="danger",t="times-circle"),null!=p)return Object(h.jsx)(d.c,{color:e,children:Object(h.jsx)(d.h,{fas:!0,icon:t})})}(),Object(h.jsx)(d.d,{onClick:function(){var e=new Headers;e.append("Content-Type","application/json");var n={id:t,sick:s,contagious:b};fetch("".concat("https://declare-ton-morveux.herokuapp.com","/api/children/"),{headers:e,method:"put",credentials:"include",body:JSON.stringify(n)}).then((function(e){e.ok?m(!0):m(!1)}))},className:"text-light",children:"Mettre \xe0 jour"})]})]})}),k=function(){var e=Object(r.useContext)(O),t=e.fetchMyChildren,n=e.user,c=e.myChildren;Object(r.useEffect)((function(){t()}),[n.id]);return Object(h.jsx)(d.g,{children:Object(h.jsx)("div",{className:"accordion",id:"accordionChildren",children:c.map((function(e,t){var n="collapse-".concat(t),c="heading-".concat(t);return Object(h.jsxs)("div",{className:"accordion-item",children:[Object(h.jsx)("h2",{className:"accordion-header",id:c,children:Object(h.jsx)("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#"+n,"aria-expanded":"false","aria-controls":n,children:e.firstName+" "+e.lastName})}),Object(h.jsx)("div",{id:n,className:"accordion-collapse collapse","aria-labelledby":c,"data-bs-parent":"#accordionChildren",children:Object(h.jsxs)("div",{className:"accordion-body",children:[Object(h.jsx)("p",{children:e.school.name}),Object(h.jsx)(N,{id:e.id,isSick:e.sick,isContagious:e.contagious})]})})]},t)}))})})},w=function(){return Object(h.jsxs)("div",{children:[Object(h.jsx)(S,{}),Object(h.jsx)(k,{})]})},A=function(){var e=Object(r.useContext)(O),t=Object(r.useState)({username:"",password:""}),n=Object(u.a)(t,2),c=n[0],o=n[1],a=Object(l.h)();return Object(h.jsx)(d.g,{children:Object(h.jsx)(d.t,{className:"d-flex justify-content-center align-items-center mt-4",children:Object(h.jsxs)(d.e,{md:"6",children:[Object(h.jsxs)("form",{children:[Object(h.jsx)("p",{className:"h5 text-center mb-4",children:"Sign in"}),Object(h.jsxs)("div",{className:"grey-text",children:[Object(h.jsx)(d.j,{type:"text",onChange:function(e){var t=e.target.value;o((function(e){return Object(b.a)(Object(b.a)({},e),{},{username:t})}))},value:c.username,label:"Nom d'utilisateur",icon:"user"}),Object(h.jsx)(d.j,{onChange:function(e){var t=e.target.value;o((function(e){return Object(b.a)(Object(b.a)({},e),{},{password:t})}))},value:c.password,type:"password",label:"Mot de passe",icon:"lock",validate:!0})]}),Object(h.jsx)("div",{className:"text-center",children:Object(h.jsx)(d.d,{style:{color:"white"},onClick:function(){var t=new Headers;t.append("Content-Type","application/json"),null!=c.username&&null!=c.password&&fetch("".concat("https://declare-ton-morveux.herokuapp.com","/authenticate"),{headers:t,method:"post",credentials:"include",body:JSON.stringify(c)}).then((function(e){if(e.ok)return e.json()})).then((function(t){t&&e.setUser(Object(b.a)({isAuthenticated:!0},t))}))},children:"Se connecter"})})]}),Object(h.jsxs)("p",{className:"mt-3",children:["Vous n'avez pas de compte ? ",Object(h.jsx)(j.b,{style:{display:"inline"},to:"".concat(a.url,"/signup"),children:"Enregistrez vous"})]})]})})})},E=function(){var e=Object(r.useState)({username:"",password:"",email:""}),t=Object(u.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(null),a=Object(u.a)(o,2),s=a[0],i=a[1];return Object(r.useEffect)((function(){s&&c((function(e){return Object(b.a)(Object(b.a)({},e),{},{username:"",password:"",email:""})}))}),[s]),Object(h.jsx)(d.g,{children:Object(h.jsx)(d.t,{className:"d-flex justify-content-center align-items-center mt-4",children:Object(h.jsxs)(d.e,{md:"6",children:[Object(h.jsxs)("form",{children:[function(){if(null!=s)return s?Object(h.jsx)(d.b,{color:"success",children:"Le compte a bien \xe9t\xe9 enregistrer"}):s?void 0:Object(h.jsx)(d.b,{color:"danger",children:"Impossible d'enregistrer le compte"})}(),Object(h.jsx)("p",{className:"h5 text-center mb-4",children:"Sign up"}),Object(h.jsxs)("div",{className:"grey-text",children:[Object(h.jsx)(d.j,{value:n.username,type:"text",label:"Nom d'utilisateur",icon:"user",onChange:function(e){var t=e.target.value;c((function(e){return Object(b.a)(Object(b.a)({},e),{},{username:t})}))}}),Object(h.jsx)(d.j,{value:n.email,type:"email",label:"Email",icon:"envelope",onChange:function(e){var t=e.target.value;c((function(e){return Object(b.a)(Object(b.a)({},e),{},{email:t})}))}}),Object(h.jsx)(d.j,{value:n.password,type:"password",label:"Mot de passe",icon:"lock",validate:!0,onChange:function(e){var t=e.target.value;c((function(e){return Object(b.a)(Object(b.a)({},e),{},{password:t})}))}})]}),Object(h.jsx)("div",{className:"text-center",children:Object(h.jsx)(d.d,{style:{color:"white"},onClick:function(){var e=new Headers;e.append("Content-Type","application/json"),null!=n.username&&null!=n.password&&fetch("".concat("https://declare-ton-morveux.herokuapp.com","/register"),{headers:e,method:"post",body:JSON.stringify(n)}).then((function(e){e.ok?i(!0):i(!1)}))},children:"S'enregistrer"})})]}),Object(h.jsxs)("p",{className:"mt-3",children:["Vous avez d\xe9j\xe0 un compte ? ",Object(h.jsx)(j.b,{style:{display:"inline"},to:"/login",children:"Connectez vous"})]})]})})})},M=function(){var e=Object(l.h)();return Object(h.jsx)("div",{className:"flex-grow-1 d-flex justify-content-center align-items-center",children:Object(h.jsx)(j.a,{children:Object(h.jsxs)(l.d,{children:[Object(h.jsx)(l.b,{path:"".concat(e.path,"/signup"),component:E}),Object(h.jsx)(l.b,{exact:!0,path:"".concat(e.path,"/"),component:A})]})})})},H=n(118),B=function(){return{responsive:!0}},D=function(){var e=Object(r.useContext)(O).schools,t=Object(r.useState)(null),n=Object(u.a)(t,2),c=n[0],o=n[1],a=function(){return Object.keys(e.selectedSchool).length>0},s=Object(r.useState)(null),i=Object(u.a)(s,2),l=i[0],j=i[1],f=function(e){var t=new Date;return Array.isArray(e)?e.map((function(e){return Object(b.a)(Object(b.a)({},e),{},{date:new Date(e.date)})})).filter((function(e){return t.getFullYear()===e.date.getFullYear()})):[]},x=function(e,t){var n=t.dataLine.labels.map((function(){return 0}));if(Array.isArray(c)){for(var o=0;o<c.length;o++){var r=c[o];if(r.contagious===e){var a=r.date.getMonth();n[a]=n[a]+1}}console.log(n)}return n};return Object(r.useEffect)((function(){a()&&fetch("".concat("https://declare-ton-morveux.herokuapp.com","/api/declarations/").concat(e.selectedSchool.id)).then((function(e){if(e.ok)return e.json()})).then((function(e){return o(f(e))}))}),[e.selectedSchool]),Object(r.useEffect)((function(){var e={dataLine:{labels:["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","D\xe9cembre"],datasets:[{label:"Malades non contagieux",fill:!0,lineTension:.3,backgroundColor:"rgba(225, 204,230, .3)",borderColor:"rgb(205, 130, 158)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgb(205, 130,1 58)",pointBackgroundColor:"rgb(255, 255, 255)",pointBorderWidth:10,pointHoverRadius:5,pointHoverBackgroundColor:"rgb(0, 0, 0)",pointHoverBorderColor:"rgba(220, 220, 220,1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:null},{label:"Malades contagieux",fill:!0,lineTension:.3,backgroundColor:"rgba(184, 185, 210, .3)",borderColor:"rgb(35, 26, 136)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgb(35, 26, 136)",pointBackgroundColor:"rgb(255, 255, 255)",pointBorderWidth:10,pointHoverRadius:5,pointHoverBackgroundColor:"rgb(0, 0, 0)",pointHoverBorderColor:"rgba(220, 220, 220, 1)",pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:null}]}};e.dataLine.datasets[0].data=x(!1,e),e.dataLine.datasets[1].data=x(!0,e),j(e),console.log("DECLARATIONS HAS CHANGED")}),[c]),Object(r.useEffect)((function(){return function(){return console.log("UNMOUNTED CHART")}}),[]),a()&&null!=l?null===c?Object(h.jsx)("div",{className:"spinner-border text-primary",role:"status",children:Object(h.jsx)("span",{className:"sr-only",children:"Loading..."})}):Object(h.jsxs)(d.g,{children:[Object(h.jsx)("h3",{className:"mt-5",children:"Graphique de l'ann\xe9e actuelle"}),Object(h.jsx)(H.a,{data:l.dataLine,options:B})]}):Object(h.jsx)("div",{})},L=n(276),I=n(279),T=n(277),J=n(278),z=function(){var e=Object(r.useContext)(O).schools,t=Object(r.useRef)();Object(r.useEffect)((function(){if(null!=e.selectedSchool.id&&null!=t.current){var n=e.selectedSchool.latitude,c=e.selectedSchool.longitude;console.log("selected school has changed"),t.current.setView([c,n],20)}}),[e.selectedSchool]);return function(){if(null!=e.selectedSchool.id){var n=e.selectedSchool.latitude,c=e.selectedSchool.longitude;return Object(h.jsx)(d.g,{children:Object(h.jsxs)(L.a,{whenCreated:function(e){t.current=e},center:[c,n],zoom:13,scrollWheelZoom:!1,style:{height:"180px"},children:[Object(h.jsx)(I.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(h.jsx)(T.a,{position:[c,n],children:Object(h.jsx)(J.a,{children:e.selectedSchool.name})})]})})}return Object(h.jsx)("div",{})}()},F=function(){var e=Object(r.useContext)(O).schools,t=Object(r.useState)(0),n=Object(u.a)(t,2),c=n[0],o=n[1],a=Object(r.useState)(0),s=Object(u.a)(a,2),i=s[0],l=s[1],j=function(){return Object.keys(e.selectedSchool).length>0};return Object(r.useEffect)((function(){j()&&(fetch("https://declare-ton-morveux.herokuapp.com/api/children/countIsSickAndIsContagiousBySchool/".concat(e.selectedSchool.id)).then((function(e){return e.json()})).then((function(e){return o(e)})),fetch("https://declare-ton-morveux.herokuapp.com/api/children/countIsSickBySchool/".concat(e.selectedSchool.id)).then((function(e){return e.json()})).then((function(e){return l(e)})))}),[e.selectedSchool]),j()?Object(h.jsx)(d.g,{children:Object(h.jsxs)(d.b,{color:"warning",children:[Object(h.jsx)("h4",{className:"alert-heading",children:"Informations"}),Object(h.jsxs)("p",{children:["Il y a eu ",i," malades dont ",c," contagieux toutes p\xe9riodes confondues"]})]})}):Object(h.jsx)("div",{})},R=function(){return Object(h.jsxs)("div",{children:[Object(h.jsx)("div",{className:"mt-4 d-flex justify-content-center",children:Object(h.jsx)(C,{})}),Object(h.jsx)(F,{}),Object(h.jsx)(z,{}),Object(h.jsx)(D,{})]})};var W=function(){return Object(h.jsxs)("div",{className:"App h-100 d-flex flex-column",children:[Object(h.jsx)("header",{children:Object(h.jsx)(x,{})}),Object(h.jsxs)(l.d,{children:[Object(h.jsx)(l.b,{exact:!0,path:"/",component:R}),Object(h.jsx)(m,{path:"/login",children:Object(h.jsx)(M,{})}),Object(h.jsx)(v,{path:"/childDeclaration",children:Object(h.jsx)(w,{})})]})]})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,280)).then((function(t){var n=t.getCLS,c=t.getFID,o=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),c(e),o(e),r(e),a(e)}))};o.a.config(),i.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(j.a,{children:Object(h.jsx)(f,{children:Object(h.jsx)(W,{})})})}),document.getElementById("root")),P()}},[[269,1,2]]]);
//# sourceMappingURL=main.7777f4e8.chunk.js.map